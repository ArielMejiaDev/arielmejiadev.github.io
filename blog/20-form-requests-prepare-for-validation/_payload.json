[{"data":1,"prerenderedAt":819},["Reactive",2],{"post-20-form-requests-prepare-for-validation":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"id":10,"published":11,"date":12,"cover_image":13,"tags":14,"announcement_banner":13,"announcement_link":13,"readingTime":16,"body":21,"_type":814,"_id":815,"_source":816,"_file":817,"_extension":818},"/blog/20-form-requests-prepare-for-validation","blog",false,"","Form Requests - Prepare for Validation","Add new values to a form request before validation in Laravel",20,true,"June 9st, 2021",null,[15],"Laravel",{"text":17,"minutes":18,"time":19,"words":20},"1 min read",0.745,44700,149,{"type":22,"children":23,"toc":808},"root",[24,47,66,73,133,138,167,421,427,474,480,775,797,802],{"type":25,"tag":26,"props":27,"children":28},"element","p",{},[29,32,38,40,45],{"type":30,"value":31},"text","Sometimes is necessary to ",{"type":25,"tag":33,"props":34,"children":35},"code",{},[36],{"type":30,"value":37},"compute/get",{"type":30,"value":39}," a value based on a ",{"type":25,"tag":33,"props":41,"children":42},{},[43],{"type":30,"value":44},"request",{"type":30,"value":46}," and then apply form request validation on it",{"type":25,"tag":26,"props":48,"children":49},{},[50,52,57,59,64],{"type":30,"value":51},"Let's imagine that is required to validate if a ",{"type":25,"tag":33,"props":53,"children":54},{},[55],{"type":30,"value":56},"user->account->hasPaidPlanAccount()",{"type":30,"value":58},", but the route only has the ",{"type":25,"tag":33,"props":60,"children":61},{},[62],{"type":30,"value":63},"/{user}",{"type":30,"value":65}," param",{"type":25,"tag":67,"props":68,"children":70},"h3",{"id":69},"create-a-custom-rule-to-validate-the-account",[71],{"type":30,"value":72},"Create a custom rule to validate the account",{"type":25,"tag":74,"props":75,"children":79},"pre",{"className":76,"code":77,"language":78,"meta":7},"language-php dracula","php artisan make:rule AccountHasAPaidPlanRule\n","php",[80],{"type":25,"tag":33,"props":81,"children":82},{"__ignoreMap":7},[83],{"type":25,"tag":84,"props":85,"children":88},"span",{"class":86,"line":87},"line",1,[89,94,100,105,109,114,119,124,128],{"type":25,"tag":84,"props":90,"children":92},{"class":91},"ct-531774",[93],{"type":30,"value":78},{"type":25,"tag":84,"props":95,"children":97},{"class":96},"ct-183901",[98],{"type":30,"value":99}," ",{"type":25,"tag":84,"props":101,"children":102},{"class":91},[103],{"type":30,"value":104},"artisan",{"type":25,"tag":84,"props":106,"children":107},{"class":96},[108],{"type":30,"value":99},{"type":25,"tag":84,"props":110,"children":111},{"class":91},[112],{"type":30,"value":113},"make",{"type":25,"tag":84,"props":115,"children":116},{"class":96},[117],{"type":30,"value":118},":",{"type":25,"tag":84,"props":120,"children":121},{"class":91},[122],{"type":30,"value":123},"rule",{"type":25,"tag":84,"props":125,"children":126},{"class":96},[127],{"type":30,"value":99},{"type":25,"tag":84,"props":129,"children":130},{"class":91},[131],{"type":30,"value":132},"AccountHasAPaidPlanRule",{"type":25,"tag":67,"props":134,"children":136},{"id":135},"accounthasapaidplanrule",[137],{"type":30,"value":132},{"type":25,"tag":26,"props":139,"children":140},{},[141,143,148,150,155,157,161,163],{"type":30,"value":142},"In our custom rule we can fetch our ",{"type":25,"tag":33,"props":144,"children":145},{},[146],{"type":30,"value":147},"Account",{"type":30,"value":149}," model based on ",{"type":25,"tag":33,"props":151,"children":152},{},[153],{"type":30,"value":154},"account_id",{"type":30,"value":156}," value from a ",{"type":25,"tag":33,"props":158,"children":159},{},[160],{"type":30,"value":44},{"type":30,"value":162},",\nan input that is not present in the ",{"type":25,"tag":33,"props":164,"children":165},{},[166],{"type":30,"value":44},{"type":25,"tag":74,"props":168,"children":170},{"className":76,"code":169,"language":78,"meta":7},"public function passes($attribute, $account_id)\n{\n    /** @var Account */\n    $account = Account::findOrFail($account_id);\n    return $account->hasPaidPlan();\n}\n\npublic function message()\n{\n   return 'The feature requires a paid plan.';\n}\n",[171],{"type":25,"tag":33,"props":172,"children":173},{"__ignoreMap":7},[174,207,216,250,287,320,329,336,366,374,412],{"type":25,"tag":84,"props":175,"children":176},{"class":86,"line":87},[177,183,187,192,196,202],{"type":25,"tag":84,"props":178,"children":180},{"class":179},"ct-166232",[181],{"type":30,"value":182},"public",{"type":25,"tag":84,"props":184,"children":185},{"class":96},[186],{"type":30,"value":99},{"type":25,"tag":84,"props":188,"children":189},{"class":179},[190],{"type":30,"value":191},"function",{"type":25,"tag":84,"props":193,"children":194},{"class":96},[195],{"type":30,"value":99},{"type":25,"tag":84,"props":197,"children":199},{"class":198},"ct-711500",[200],{"type":30,"value":201},"passes",{"type":25,"tag":84,"props":203,"children":204},{"class":96},[205],{"type":30,"value":206},"($attribute, $account_id)\n",{"type":25,"tag":84,"props":208,"children":210},{"class":86,"line":209},2,[211],{"type":25,"tag":84,"props":212,"children":213},{"class":96},[214],{"type":30,"value":215},"{\n",{"type":25,"tag":84,"props":217,"children":219},{"class":86,"line":218},3,[220,225,231,236,240,245],{"type":25,"tag":84,"props":221,"children":222},{"class":96},[223],{"type":30,"value":224},"    ",{"type":25,"tag":84,"props":226,"children":228},{"class":227},"ct-784317",[229],{"type":30,"value":230},"/** ",{"type":25,"tag":84,"props":232,"children":233},{"class":179},[234],{"type":30,"value":235},"@var",{"type":25,"tag":84,"props":237,"children":238},{"class":227},[239],{"type":30,"value":99},{"type":25,"tag":84,"props":241,"children":243},{"class":242},"ct-432594",[244],{"type":30,"value":147},{"type":25,"tag":84,"props":246,"children":247},{"class":227},[248],{"type":30,"value":249}," */\n",{"type":25,"tag":84,"props":251,"children":253},{"class":86,"line":252},4,[254,259,264,268,272,277,282],{"type":25,"tag":84,"props":255,"children":256},{"class":96},[257],{"type":30,"value":258},"    $account ",{"type":25,"tag":84,"props":260,"children":261},{"class":179},[262],{"type":30,"value":263},"=",{"type":25,"tag":84,"props":265,"children":266},{"class":96},[267],{"type":30,"value":99},{"type":25,"tag":84,"props":269,"children":270},{"class":242},[271],{"type":30,"value":147},{"type":25,"tag":84,"props":273,"children":274},{"class":179},[275],{"type":30,"value":276},"::",{"type":25,"tag":84,"props":278,"children":279},{"class":198},[280],{"type":30,"value":281},"findOrFail",{"type":25,"tag":84,"props":283,"children":284},{"class":96},[285],{"type":30,"value":286},"($account_id);\n",{"type":25,"tag":84,"props":288,"children":290},{"class":86,"line":289},5,[291,295,300,305,310,315],{"type":25,"tag":84,"props":292,"children":293},{"class":96},[294],{"type":30,"value":224},{"type":25,"tag":84,"props":296,"children":297},{"class":179},[298],{"type":30,"value":299},"return",{"type":25,"tag":84,"props":301,"children":302},{"class":96},[303],{"type":30,"value":304}," $account",{"type":25,"tag":84,"props":306,"children":307},{"class":179},[308],{"type":30,"value":309},"->",{"type":25,"tag":84,"props":311,"children":312},{"class":198},[313],{"type":30,"value":314},"hasPaidPlan",{"type":25,"tag":84,"props":316,"children":317},{"class":96},[318],{"type":30,"value":319},"();\n",{"type":25,"tag":84,"props":321,"children":323},{"class":86,"line":322},6,[324],{"type":25,"tag":84,"props":325,"children":326},{"class":96},[327],{"type":30,"value":328},"}\n",{"type":25,"tag":84,"props":330,"children":332},{"class":86,"line":331},7,[333],{"type":25,"tag":84,"props":334,"children":335},{},[],{"type":25,"tag":84,"props":337,"children":339},{"class":86,"line":338},8,[340,344,348,352,356,361],{"type":25,"tag":84,"props":341,"children":342},{"class":179},[343],{"type":30,"value":182},{"type":25,"tag":84,"props":345,"children":346},{"class":96},[347],{"type":30,"value":99},{"type":25,"tag":84,"props":349,"children":350},{"class":179},[351],{"type":30,"value":191},{"type":25,"tag":84,"props":353,"children":354},{"class":96},[355],{"type":30,"value":99},{"type":25,"tag":84,"props":357,"children":358},{"class":198},[359],{"type":30,"value":360},"message",{"type":25,"tag":84,"props":362,"children":363},{"class":96},[364],{"type":30,"value":365},"()\n",{"type":25,"tag":84,"props":367,"children":369},{"class":86,"line":368},9,[370],{"type":25,"tag":84,"props":371,"children":372},{"class":96},[373],{"type":30,"value":215},{"type":25,"tag":84,"props":375,"children":377},{"class":86,"line":376},10,[378,383,387,391,397,403,407],{"type":25,"tag":84,"props":379,"children":380},{"class":96},[381],{"type":30,"value":382},"   ",{"type":25,"tag":84,"props":384,"children":385},{"class":179},[386],{"type":30,"value":299},{"type":25,"tag":84,"props":388,"children":389},{"class":96},[390],{"type":30,"value":99},{"type":25,"tag":84,"props":392,"children":394},{"class":393},"ct-882767",[395],{"type":30,"value":396},"'",{"type":25,"tag":84,"props":398,"children":400},{"class":399},"ct-035036",[401],{"type":30,"value":402},"The feature requires a paid plan.",{"type":25,"tag":84,"props":404,"children":405},{"class":393},[406],{"type":30,"value":396},{"type":25,"tag":84,"props":408,"children":409},{"class":96},[410],{"type":30,"value":411},";\n",{"type":25,"tag":84,"props":413,"children":415},{"class":86,"line":414},11,[416],{"type":25,"tag":84,"props":417,"children":418},{"class":96},[419],{"type":30,"value":420},"}",{"type":25,"tag":67,"props":422,"children":424},{"id":423},"make-a-form-request",[425],{"type":30,"value":426},"Make a form request",{"type":25,"tag":74,"props":428,"children":430},{"className":76,"code":429,"language":78,"meta":7},"php artisan make:request FeatureRequest\n",[431],{"type":25,"tag":33,"props":432,"children":433},{"__ignoreMap":7},[434],{"type":25,"tag":84,"props":435,"children":436},{"class":86,"line":87},[437,441,445,449,453,457,461,465,469],{"type":25,"tag":84,"props":438,"children":439},{"class":91},[440],{"type":30,"value":78},{"type":25,"tag":84,"props":442,"children":443},{"class":96},[444],{"type":30,"value":99},{"type":25,"tag":84,"props":446,"children":447},{"class":91},[448],{"type":30,"value":104},{"type":25,"tag":84,"props":450,"children":451},{"class":96},[452],{"type":30,"value":99},{"type":25,"tag":84,"props":454,"children":455},{"class":91},[456],{"type":30,"value":113},{"type":25,"tag":84,"props":458,"children":459},{"class":96},[460],{"type":30,"value":118},{"type":25,"tag":84,"props":462,"children":463},{"class":91},[464],{"type":30,"value":44},{"type":25,"tag":84,"props":466,"children":467},{"class":96},[468],{"type":30,"value":99},{"type":25,"tag":84,"props":470,"children":471},{"class":91},[472],{"type":30,"value":473},"FeatureRequest",{"type":25,"tag":67,"props":475,"children":477},{"id":476},"using-prepareforvalidation",[478],{"type":30,"value":479},"Using PrepareForValidation",{"type":25,"tag":74,"props":481,"children":483},{"className":76,"code":482,"language":78,"meta":7},"// add the account_id as a request input\npublic function prepareForValidation()\n{\n    $this->merge([\n        'account_id' => $this->route('user')->account_id,\n    ]);\n}\n\npublic function rules()\n{\n    return [\n        'account_id' => [new AccountHasAPaidPlanRule]\n    ];        \n}\n",[484],{"type":25,"tag":33,"props":485,"children":486},{"__ignoreMap":7},[487,495,523,530,557,635,643,650,656,684,691,707,758,767],{"type":25,"tag":84,"props":488,"children":489},{"class":86,"line":87},[490],{"type":25,"tag":84,"props":491,"children":492},{"class":227},[493],{"type":30,"value":494},"// add the account_id as a request input\n",{"type":25,"tag":84,"props":496,"children":497},{"class":86,"line":209},[498,502,506,510,514,519],{"type":25,"tag":84,"props":499,"children":500},{"class":179},[501],{"type":30,"value":182},{"type":25,"tag":84,"props":503,"children":504},{"class":96},[505],{"type":30,"value":99},{"type":25,"tag":84,"props":507,"children":508},{"class":179},[509],{"type":30,"value":191},{"type":25,"tag":84,"props":511,"children":512},{"class":96},[513],{"type":30,"value":99},{"type":25,"tag":84,"props":515,"children":516},{"class":198},[517],{"type":30,"value":518},"prepareForValidation",{"type":25,"tag":84,"props":520,"children":521},{"class":96},[522],{"type":30,"value":365},{"type":25,"tag":84,"props":524,"children":525},{"class":86,"line":218},[526],{"type":25,"tag":84,"props":527,"children":528},{"class":96},[529],{"type":30,"value":215},{"type":25,"tag":84,"props":531,"children":532},{"class":86,"line":252},[533,537,543,547,552],{"type":25,"tag":84,"props":534,"children":535},{"class":96},[536],{"type":30,"value":224},{"type":25,"tag":84,"props":538,"children":540},{"class":539},"ct-531775",[541],{"type":30,"value":542},"$this",{"type":25,"tag":84,"props":544,"children":545},{"class":179},[546],{"type":30,"value":309},{"type":25,"tag":84,"props":548,"children":549},{"class":198},[550],{"type":30,"value":551},"merge",{"type":25,"tag":84,"props":553,"children":554},{"class":96},[555],{"type":30,"value":556},"([\n",{"type":25,"tag":84,"props":558,"children":559},{"class":86,"line":289},[560,565,569,573,577,581,586,590,594,598,603,608,612,617,621,626,630],{"type":25,"tag":84,"props":561,"children":562},{"class":96},[563],{"type":30,"value":564},"        ",{"type":25,"tag":84,"props":566,"children":567},{"class":393},[568],{"type":30,"value":396},{"type":25,"tag":84,"props":570,"children":571},{"class":399},[572],{"type":30,"value":154},{"type":25,"tag":84,"props":574,"children":575},{"class":393},[576],{"type":30,"value":396},{"type":25,"tag":84,"props":578,"children":579},{"class":96},[580],{"type":30,"value":99},{"type":25,"tag":84,"props":582,"children":583},{"class":179},[584],{"type":30,"value":585},"=>",{"type":25,"tag":84,"props":587,"children":588},{"class":96},[589],{"type":30,"value":99},{"type":25,"tag":84,"props":591,"children":592},{"class":539},[593],{"type":30,"value":542},{"type":25,"tag":84,"props":595,"children":596},{"class":179},[597],{"type":30,"value":309},{"type":25,"tag":84,"props":599,"children":600},{"class":198},[601],{"type":30,"value":602},"route",{"type":25,"tag":84,"props":604,"children":605},{"class":96},[606],{"type":30,"value":607},"(",{"type":25,"tag":84,"props":609,"children":610},{"class":393},[611],{"type":30,"value":396},{"type":25,"tag":84,"props":613,"children":614},{"class":399},[615],{"type":30,"value":616},"user",{"type":25,"tag":84,"props":618,"children":619},{"class":393},[620],{"type":30,"value":396},{"type":25,"tag":84,"props":622,"children":623},{"class":96},[624],{"type":30,"value":625},")",{"type":25,"tag":84,"props":627,"children":628},{"class":179},[629],{"type":30,"value":309},{"type":25,"tag":84,"props":631,"children":632},{"class":96},[633],{"type":30,"value":634},"account_id,\n",{"type":25,"tag":84,"props":636,"children":637},{"class":86,"line":322},[638],{"type":25,"tag":84,"props":639,"children":640},{"class":96},[641],{"type":30,"value":642},"    ]);\n",{"type":25,"tag":84,"props":644,"children":645},{"class":86,"line":331},[646],{"type":25,"tag":84,"props":647,"children":648},{"class":96},[649],{"type":30,"value":328},{"type":25,"tag":84,"props":651,"children":652},{"class":86,"line":338},[653],{"type":25,"tag":84,"props":654,"children":655},{},[],{"type":25,"tag":84,"props":657,"children":658},{"class":86,"line":368},[659,663,667,671,675,680],{"type":25,"tag":84,"props":660,"children":661},{"class":179},[662],{"type":30,"value":182},{"type":25,"tag":84,"props":664,"children":665},{"class":96},[666],{"type":30,"value":99},{"type":25,"tag":84,"props":668,"children":669},{"class":179},[670],{"type":30,"value":191},{"type":25,"tag":84,"props":672,"children":673},{"class":96},[674],{"type":30,"value":99},{"type":25,"tag":84,"props":676,"children":677},{"class":198},[678],{"type":30,"value":679},"rules",{"type":25,"tag":84,"props":681,"children":682},{"class":96},[683],{"type":30,"value":365},{"type":25,"tag":84,"props":685,"children":686},{"class":86,"line":376},[687],{"type":25,"tag":84,"props":688,"children":689},{"class":96},[690],{"type":30,"value":215},{"type":25,"tag":84,"props":692,"children":693},{"class":86,"line":414},[694,698,702],{"type":25,"tag":84,"props":695,"children":696},{"class":96},[697],{"type":30,"value":224},{"type":25,"tag":84,"props":699,"children":700},{"class":179},[701],{"type":30,"value":299},{"type":25,"tag":84,"props":703,"children":704},{"class":96},[705],{"type":30,"value":706}," [\n",{"type":25,"tag":84,"props":708,"children":710},{"class":86,"line":709},12,[711,715,719,723,727,731,735,740,745,749,753],{"type":25,"tag":84,"props":712,"children":713},{"class":96},[714],{"type":30,"value":564},{"type":25,"tag":84,"props":716,"children":717},{"class":393},[718],{"type":30,"value":396},{"type":25,"tag":84,"props":720,"children":721},{"class":399},[722],{"type":30,"value":154},{"type":25,"tag":84,"props":724,"children":725},{"class":393},[726],{"type":30,"value":396},{"type":25,"tag":84,"props":728,"children":729},{"class":96},[730],{"type":30,"value":99},{"type":25,"tag":84,"props":732,"children":733},{"class":179},[734],{"type":30,"value":585},{"type":25,"tag":84,"props":736,"children":737},{"class":96},[738],{"type":30,"value":739}," [",{"type":25,"tag":84,"props":741,"children":742},{"class":179},[743],{"type":30,"value":744},"new",{"type":25,"tag":84,"props":746,"children":747},{"class":96},[748],{"type":30,"value":99},{"type":25,"tag":84,"props":750,"children":751},{"class":242},[752],{"type":30,"value":132},{"type":25,"tag":84,"props":754,"children":755},{"class":96},[756],{"type":30,"value":757},"]\n",{"type":25,"tag":84,"props":759,"children":761},{"class":86,"line":760},13,[762],{"type":25,"tag":84,"props":763,"children":764},{"class":96},[765],{"type":30,"value":766},"    ];        \n",{"type":25,"tag":84,"props":768,"children":770},{"class":86,"line":769},14,[771],{"type":25,"tag":84,"props":772,"children":773},{"class":96},[774],{"type":30,"value":420},{"type":25,"tag":26,"props":776,"children":777},{},[778,780,784,785,789,791,795],{"type":30,"value":779},"Our custom rule does not depend on ",{"type":25,"tag":33,"props":781,"children":782},{},[783],{"type":30,"value":44},{"type":30,"value":99},{"type":25,"tag":33,"props":786,"children":787},{},[788],{"type":30,"value":154},{"type":30,"value":790}," presence, so it can be used when ",{"type":25,"tag":33,"props":792,"children":793},{},[794],{"type":30,"value":44},{"type":30,"value":796}," has it or not without issues.",{"type":25,"tag":26,"props":798,"children":799},{},[800],{"type":30,"value":801},"Thanks for reading!",{"type":25,"tag":803,"props":804,"children":805},"style",{},[806],{"type":30,"value":807},".dracula{color:#F8F8F2;background:#282A36;}.ct-531774{color:#BD93F9;}.ct-183901{color:#F8F8F2;}.ct-166232{color:#FF79C6;}.ct-711500{color:#50FA7B;}.ct-784317{color:#6272A4;}.ct-432594{color:#8BE9FD;font-style:italic;}.ct-882767{color:#E9F284;}.ct-035036{color:#F1FA8C;}.ct-531775{color:#BD93F9;font-style:italic;}",{"title":7,"searchDepth":209,"depth":209,"links":809},[810,811,812,813],{"id":69,"depth":218,"text":72},{"id":135,"depth":218,"text":132},{"id":423,"depth":218,"text":426},{"id":476,"depth":218,"text":479},"markdown","content:blog:20-form-requests-prepare-for-validation.md","content","blog/20-form-requests-prepare-for-validation.md","md",1697073301981]