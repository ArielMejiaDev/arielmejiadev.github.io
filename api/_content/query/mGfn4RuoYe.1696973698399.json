{"_path":"/blog/20-form-requests-prepare-for-validation","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Form Requests - Prepare for Validation","description":"Add new values to a form request before validation in Laravel","id":20,"published":true,"date":"June 9st, 2021","cover_image":null,"tags":["Laravel"],"announcement_banner":null,"announcement_link":null,"readingTime":{"text":"1 min read","minutes":0.745,"time":44700,"words":149},"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sometimes is necessary to "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"compute/get"}]},{"type":"text","value":" a value based on a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"request"}]},{"type":"text","value":" and then apply form request validation on it"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's imagine that is required to validate if a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"user->account->hasPaidPlanAccount()"}]},{"type":"text","value":", but the route only has the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"/{user}"}]},{"type":"text","value":" param"}]},{"type":"element","tag":"h3","props":{"id":"create-a-custom-rule-to-validate-the-account"},"children":[{"type":"text","value":"Create a custom rule to validate the account"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"php artisan make:rule AccountHasAPaidPlanRule\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"php"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"artisan"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"rule"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"AccountHasAPaidPlanRule"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"accounthasapaidplanrule"},"children":[{"type":"text","value":"AccountHasAPaidPlanRule"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In our custom rule we can fetch our "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Account"}]},{"type":"text","value":" model based on "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"account_id"}]},{"type":"text","value":" value from a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"request"}]},{"type":"text","value":",\nan input that is not present in the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"request"}]}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"public function passes($attribute, $account_id)\n{\n    /** @var Account */\n    $account = Account::findOrFail($account_id);\n    return $account->hasPaidPlan();\n}\n\npublic function message()\n{\n   return 'The feature requires a paid plan.';\n}\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"passes"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"($attribute, $account_id)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-784317"},"children":[{"type":"text","value":"/** "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"@var"}]},{"type":"element","tag":"span","props":{"class":"ct-784317"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Account"}]},{"type":"element","tag":"span","props":{"class":"ct-784317"},"children":[{"type":"text","value":" */\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    $account "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Account"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"findOrFail"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"($account_id);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" $account"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"hasPaidPlan"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"message"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"   "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"The feature requires a paid plan."}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"make-a-form-request"},"children":[{"type":"text","value":"Make a form request"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"php artisan make:request FeatureRequest\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"php"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"artisan"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"request"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"FeatureRequest"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"using-prepareforvalidation"},"children":[{"type":"text","value":"Using PrepareForValidation"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"// add the account_id as a request input\npublic function prepareForValidation()\n{\n    $this->merge([\n        'account_id' => $this->route('user')->account_id,\n    ]);\n}\n\npublic function rules()\n{\n    return [\n        'account_id' => [new AccountHasAPaidPlanRule]\n    ];        \n}\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-784317"},"children":[{"type":"text","value":"// add the account_id as a request input\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"prepareForValidation"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-531775"},"children":[{"type":"text","value":"$this"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"merge"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"([\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"account_id"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531775"},"children":[{"type":"text","value":"$this"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"route"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"user"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"account_id,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    ]);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"rules"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"account_id"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"AccountHasAPaidPlanRule"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    ];        \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Our custom rule does not depend on "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"request"}]},{"type":"text","value":" "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"account_id"}]},{"type":"text","value":" presence, so it can be used when "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"request"}]},{"type":"text","value":" has it or not without issues."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Thanks for reading!"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":".dracula{color:#F8F8F2;background:#282A36;}.ct-531774{color:#BD93F9;}.ct-183901{color:#F8F8F2;}.ct-166232{color:#FF79C6;}.ct-711500{color:#50FA7B;}.ct-784317{color:#6272A4;}.ct-432594{color:#8BE9FD;font-style:italic;}.ct-882767{color:#E9F284;}.ct-035036{color:#F1FA8C;}.ct-531775{color:#BD93F9;font-style:italic;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"create-a-custom-rule-to-validate-the-account","depth":3,"text":"Create a custom rule to validate the account"},{"id":"accounthasapaidplanrule","depth":3,"text":"AccountHasAPaidPlanRule"},{"id":"make-a-form-request","depth":3,"text":"Make a form request"},{"id":"using-prepareforvalidation","depth":3,"text":"Using PrepareForValidation"}]}},"_type":"markdown","_id":"content:blog:20-form-requests-prepare-for-validation.md","_source":"content","_file":"blog/20-form-requests-prepare-for-validation.md","_extension":"md"}