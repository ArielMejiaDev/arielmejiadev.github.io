{"_path":"/blog/12-fix-ambiguous-column-eloquent-exception","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Fix - Ambiguous Column Eloquent Query Exception in Laravel","description":"Get only the columns that your query requires from a model, and it's relationship without issues","id":12,"published":true,"date":"October 14th, 2020","cover_image":"https://dev-to-uploads.s3.amazonaws.com/i/c5vik4dlgowawfh51h6t.png","tags":["Laravel"],"announcement_banner":null,"announcement_link":null,"readingTime":{"text":"1 min read","minutes":0.66,"time":39600,"words":132},"body":{"type":"root","children":[{"type":"element","tag":"hr","props":{"id":""},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Issue"}]},{"type":"text","value":": An "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Eloquent"}]},{"type":"text","value":" Model with a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"relationship"}]},{"type":"text","value":", both have a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"column"}]},{"type":"text","value":" that matches the same "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"name"}]}]},{"type":"element","tag":"hr","props":{"id":"_1"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's check an example to show how to fix it"}]},{"type":"element","tag":"h2","props":{"id":"user-model"},"children":[{"type":"text","value":"User Model:"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"public function teams()\n{\n    return $this->belongsToMany(Team::class);\n}\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"teams"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531775"},"children":[{"type":"text","value":"$this"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"belongsToMany"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Team"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::class"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"team-model"},"children":[{"type":"text","value":"Team Model"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"public function users()\n{\n    return $this->belongsToMany(User::class);\n}\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"users"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531775"},"children":[{"type":"text","value":"$this"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"belongsToMany"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::class"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then you can attach "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"users"}]},{"type":"text","value":" to "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"teams"}]}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"Team::users()->attach(auth()->user());\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Team"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"users"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"attach"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"auth"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"user"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"());"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And now you can get a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"collection"}]},{"type":"text","value":" of "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"users"}]},{"type":"text","value":" by "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"teams"}]}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"$users = Team::users;\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"$users "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Team"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"users"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":";"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ok here all fine, maybe you need to pass data to an API,\nand it's a better approach to get only the data that is required"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"$team = Team::first();\n$team->users()->select(['name', 'email'])->get();\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"$team "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Team"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"first"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"$team"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"users"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"(["}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"email"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"])"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"();"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here you would see an "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"eloquent"}]},{"type":"text","value":" exception, this is because the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"User"}]},{"type":"text","value":" model has a column "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"name"}]},{"type":"text","value":"\nand "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Team"}]},{"type":"text","value":" model could have a column "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"name"}]},{"type":"text","value":" too,"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Don't worry like all in "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"Laravel"}]},{"type":"text","value":" is really easy, just be explicit with the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"table"}]},{"type":"text","value":" and the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"columns"}]},{"type":"text","value":" that you need"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"Team::users()->select(['users.name', 'users.email'])->get();\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Team"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"users"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"select"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"(["}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"users.name"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"users.email"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"])"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"();"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The same idea apply when you need to add a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"where"}]},{"type":"text","value":" method"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"Team::users()->where('users.email', $request->get('email'))->get();\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Team"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"users"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"()"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"where"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"users.email"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":", $request"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"email"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"))"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"();"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Thanks for reading!"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":".dracula{color:#F8F8F2;background:#282A36;}.ct-166232{color:#FF79C6;}.ct-183901{color:#F8F8F2;}.ct-711500{color:#50FA7B;}.ct-531775{color:#BD93F9;font-style:italic;}.ct-432594{color:#8BE9FD;font-style:italic;}.ct-531774{color:#BD93F9;}.ct-882767{color:#E9F284;}.ct-035036{color:#F1FA8C;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"user-model","depth":2,"text":"User Model:"},{"id":"team-model","depth":2,"text":"Team Model"}]}},"_type":"markdown","_id":"content:blog:12-fix-ambiguous-column-eloquent-exception.md","_source":"content","_file":"blog/12-fix-ambiguous-column-eloquent-exception.md","_extension":"md"}