{"_path":"/blog/2-set-dynamic-subdomains-with-laravel-forge","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Set dynamic subdomains in Laravel Forge.","description":"Set dynamic subdomains for multiple users, organizations or any other model in production with Laravel forge","id":2,"published":true,"date":"June 3rd, 2020","cover_image":"https://dev-to-uploads.s3.amazonaws.com/i/lsqvvvptoj6y0tba76fq.png","tags":["Laravel","DevOps"],"announcement_banner":null,"announcement_link":null,"readingTime":{"text":"2 min read","minutes":1.605,"time":96300,"words":321},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"in-development"},"children":[{"type":"text","value":"In Development"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"routes/web.php"}]},{"type":"text","value":" paste the route group:"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"Route::domain('{user:slug}.' . config('app.base_url'))->group(function () {\n\n    Route::get('/', UserController::class)->name('user.homepage');\n\n});\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Route"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"domain"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"{user:slug}."}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"config"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"app.base_url"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"))"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"group"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"Route"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"get"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"UserController"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"::class"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":")"}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"->"}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"user.homepage"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"});"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"base_url"}]},{"type":"text","value":" is added by the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"config()"}]},{"type":"text","value":" helper, do not use the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"env()"}]},{"type":"text","value":" method here,\nthis could cause errors if you fired the command "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"php artisan cache:clear"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this example you would need to add the column "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"slug"}]},{"type":"text","value":" in your user migration."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The part of the route that adds the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"base_url"}]},{"type":"text","value":" should be added in "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"config/app.php"}]}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"'base_url' => env('BASE_URL', 'localhost'),\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"base_url"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":"env"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"BASE_URL"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":","}]},{"type":"element","tag":"span","props":{"class":"ct-711500"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-035036"},"children":[{"type":"text","value":"localhost"}]},{"type":"element","tag":"span","props":{"class":"ct-882767"},"children":[{"type":"text","value":"'"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"),"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Set a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"base_url"}]},{"type":"text","value":" in the application "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":".env"}]},{"type":"text","value":" file:"}]},{"type":"element","tag":"pre","props":{"className":"language-dotenv dracula","code":"BASE_URL=myapp.test\n","language":"dotenv","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"BASE_URL=myapp.test"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"create-a-controller"},"children":[{"type":"text","value":"Create a controller"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"app/Http/Controllers/Users/UserController"}]},{"type":"text","value":":"}]},{"type":"element","tag":"pre","props":{"className":"language-php dracula","code":"public function __invoke(User $user)\n{\n    return $user;\n}\n","language":"php","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-531774"},"children":[{"type":"text","value":"__invoke"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-432594"},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" $user)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-166232"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":" $user;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-183901"},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now it can be tested in the browser with something like: "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"/john-doe/myapp.test"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It returns the corresponding user for that slug, if you do not have any user with the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"slug"}]},{"type":"text","value":" it will throw a 404 error."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can add users with tinker and test it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If all works it is time to make a deployment on "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"forge"}]},{"type":"text","value":", in this example I will use "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"digital ocean"}]},{"type":"text","value":" as the server provider."}]},{"type":"element","tag":"h2","props":{"id":"_1-create-your-project-on-forge"},"children":[{"type":"text","value":"1 Create your project on forge:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Just write your domain and be sure to check "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"allow wildcards"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Create Server in Forge Screen","src":"/images/blog/2/forge-screen.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"_2-add-your-repo"},"children":[{"type":"text","value":"2 Add your repo:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The full repo name comes from the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"github"}]},{"type":"text","value":" repo url (highlighted):"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Create Repository home in github","src":"/images/blog/2/github-screen.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This convention from "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"githubusername/repo"}]},{"type":"text","value":" goes in the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"repository"}]},{"type":"text","value":" field in "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"forge"}]},{"type":"text","value":":"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Set Github in Forge Screen","src":"/images/blog/2/forge-screen-2.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"_3-set-your-environment"},"children":[{"type":"text","value":"3 Set your environment:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It needs to add the proper "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"APP_URL"}]},{"type":"text","value":" value in the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":".env"}]},{"type":"text","value":" file on forge:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Edit Env File in Forge Screen","src":"/images/blog/2/forge-screen-3.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here I add the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"BASE_URL"}]},{"type":"text","value":" and make the "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"APP_URL"}]},{"type":"text","value":" dynamically, but both can also be written."}]},{"type":"element","tag":"h2","props":{"id":"_4-set-the-domain-in-digital-ocean"},"children":[{"type":"text","value":"4 Set the domain in Digital Ocean:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You need to add some records:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"by default an "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" record for the base url "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"@"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"a "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"CNAME"}]},{"type":"text","value":" record for "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"www"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"and a multi-domain "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"A"}]},{"type":"text","value":" record with "},{"type":"element","tag":"code","props":{},"children":[{"type":"text","value":"*."}]},{"type":"text","value":" as a prefix"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is how your config should look like:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"A Records in Digital Ocean Dashboard","src":"/images/blog/2/digital-ocean-screen.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"_5-create-an-api-token"},"children":[{"type":"text","value":"5 Create an API TOKEN"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"On the sidebar, go to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"API"}]},{"type":"text","value":" section and generate a "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"new token"}]},{"type":"text","value":", copy the token and save it for later"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Create Personal Access Tokens Digital Ocean Dashboard","src":"/images/blog/2/digital-ocean-screen-2.png"},"children":[]}]},{"type":"element","tag":"h2","props":{"id":"_6-configure-the-ssl-certificate"},"children":[{"type":"text","value":"6 Configure the SSL certificate:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This step is particularly complicated because sometimes it takes a couple of hours to properly propagate the changes\nfrom "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Digital Ocean"}]},{"type":"text","value":", this applies to any other provider."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"Add SSL Certificate in Forge","src":"/images/blog/2/forge-screen-4.png"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sometimes it works immediately, and sometimes takes a while and needs more time to get propagation,\nbetween 2 or 6 hours, but it can take more."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Thanks for reading!"}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":".dracula{color:#F8F8F2;background:#282A36;}.ct-432594{color:#8BE9FD;font-style:italic;}.ct-166232{color:#FF79C6;}.ct-711500{color:#50FA7B;}.ct-183901{color:#F8F8F2;}.ct-882767{color:#E9F284;}.ct-035036{color:#F1FA8C;}.ct-531774{color:#BD93F9;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"in-development","depth":2,"text":"In Development"},{"id":"create-a-controller","depth":2,"text":"Create a controller"},{"id":"_1-create-your-project-on-forge","depth":2,"text":"1 Create your project on forge:"},{"id":"_2-add-your-repo","depth":2,"text":"2 Add your repo:"},{"id":"_3-set-your-environment","depth":2,"text":"3 Set your environment:"},{"id":"_4-set-the-domain-in-digital-ocean","depth":2,"text":"4 Set the domain in Digital Ocean:"},{"id":"_5-create-an-api-token","depth":2,"text":"5 Create an API TOKEN"},{"id":"_6-configure-the-ssl-certificate","depth":2,"text":"6 Configure the SSL certificate:"}]}},"_type":"markdown","_id":"content:blog:2-set-dynamic-subdomains-with-laravel-forge.md","_source":"content","_file":"blog/2-set-dynamic-subdomains-with-laravel-forge.md","_extension":"md"}